
<div class="container px-5 px-sm-0">
    <div class="row">
        <div class="col-md-3">
            <%= render 'users/info', user: @user %>
            <%= render 'books/new', book: @book_new %>
        </div>
            <div class="col-md-8 offset-md-1">
                <h2>Book detail</h2>
                <table class="table">
                    <tbody>
                        <tr>
                            <td>
                                <%= link_to user_path(@user.id) do %>
                                  <%= attachment_image_tag @user, :profile_image, size: "40x40", fallback: "no_image.jpg"%>

                                <% end %>

                            <td>
                                <%= link_to @user.name, user_path(@user.id) %>
                            </td>
                            <td>
                                <%= link_to @book.title, book_path %>
                            </td>
                            <td>
                                <%= @book.body %>
                            </td>
                            <td>
                                <% if @book.favorited_by?(current_user) %>
                                    <p>
                                      <%= link_to book_favorites_path(@book), method: :delete do %>
                                        ♥<%= @book.favorites.count %>
                                    <% end %>
                                    </p>
                                    <% else %>
                                    <p>
                                      <%= link_to book_favorites_path(@book), method: :post do %>
                                        ♡<%= @book.favorites.count %>
                                    <% end %>
                                <% end %>
                            </td>
                            <td>
                                <p><%= link_to "#{@book.post_comments.count} コメント", book_path(@book.id) %></p>
                            </td>
                            <% if @user.id == current_user.id %>
                            <td>
                                <%= link_to "Edit", edit_book_path, class:"btn btn-sm btn-success" %>
                            </td>
                            <td>
                                <%= link_to "Destroy", book_path(@book),  method: :delete, "data-confirm" => "本当に消しますか？", class:"btn btn-sm btn-danger" %>
                            </td>
                            <% end %>
                        </tr>
                    </tbody>
                </table>
                <p>コメント件数：<%= @book.post_comments.count %></p>
                <% @book.post_comments.each do |post_comment| %>
                <p>
                    <%= image_tag('no_image.jpg', size: "40x40") %>
                    <%= post_comment.user.name %>
                    <%= post_comment.comment %>
                </p>
                <% end %>
                <% if @post_comment.user == current_user %>
                <td>
                    <%= link_to "Destroy", book_post_comments_path(@post_comment.book, @post_comment), method: :delete, class:"btn btn-sm btn-danger" %>
                </td>
                <% end %>
                <%= form_with(model:[@book, @post_comment], local: true) do |f| %>
                    <%= f.text_area :comment, rows:'5',placeholder: "コメントをここに" %>
                    <%= f.submit "送信する" %>
                <% end %>

            </div>
    </div>
</div>
